sn = {}
sn.coordinate = require 'sn.coordinate'
sn.player = require 'sn.player'
sn.tile = require 'sn.tile'

function love.load ()
	-- {{{ Level
	level = {
		{ '#', '#', '#', '#', '#', ' ', ' ', '#', '#', '#', '#', '#', ' ', ' ', '#', '#', '#', '#', '#' },
		{ '#', '.', '.', '.', '#', ' ', ' ', '#', '.', '.', '.', '#', ' ', ' ', '#', '.', '.', '.', '#' },
		{ '#', '.', '.', '.', '#', '#', '#', '#', '.', '.', '.', '#', '#', '#', '#', '.', '.', '.', '#' },
		{ '#', '.', 's', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#' },
		{ '#', '.', '.', '.', '#', '#', '#', '#', '.', '.', '.', '#', '#', '#', '#', '.', '.', '.', '#' },
		{ '#', '.', '.', '.', '#', ' ', ' ', '#', '.', '.', '.', '#', ' ', ' ', '#', '.', '.', '.', '#' },
		{ '#', '#', '.', '#', '#', ' ', ' ', '#', '#', '.', '#', '#', ' ', ' ', '#', '#', '.', '#', '#' },
		{ ' ', '#', '.', '#', ' ', ' ', ' ', ' ', '#', '.', '#', ' ', ' ', ' ', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', ' ', ' ', ' ', '#', '.', '#', ' ', ' ', ' ', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', ' ', ' ', ' ', '#', '.', '#', ' ', ' ', ' ', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '#', '#', '#', '.', '#', '#', '#', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '.', '.', '.', '.', '.', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '.', '.', '.', '.', '.', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '.', '.', '.', '.', '.', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '.', '.', '.', '.', '.', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '.', '.', '.', '.', '.', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '.', '.', '.', '.', '.', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '#', '#', '#', '#', '#', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '#', ' ', ' ', ' ', '#', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '#', ' ', ' ', ' ', '#', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '#', ' ', ' ', ' ', '#', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '#', '#', '#', '#', '#', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '.', '.', '.', '.', '.', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '.', '.', '.', '.', '.', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '.', '.', '.', '.', '.', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '.', '.', '.', '.', '.', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '.', '.', '.', '.', '.', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '.', '.', '.', '.', '.', '.', '.', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', '#', '#', '#', '#', '.', '#', '#', '#', '#', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', ' ', ' ', ' ', '#', '.', '#', ' ', ' ', ' ', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', ' ', ' ', ' ', '#', '.', '#', ' ', ' ', ' ', ' ', '#', '.', '#', ' ' },
		{ ' ', '#', '.', '#', ' ', ' ', ' ', ' ', '#', '.', '#', ' ', ' ', ' ', ' ', '#', '.', '#', ' ' },
		{ '#', '#', '.', '#', '#', ' ', ' ', '#', '#', '.', '#', '#', ' ', ' ', '#', '#', '.', '#', '#' },
		{ '#', '.', '.', '.', '#', ' ', ' ', '#', '.', '.', '.', '#', ' ', ' ', '#', '.', '.', '.', '#' },
		{ '#', '.', '.', '.', '#', '#', '#', '#', '.', '.', '.', '#', '#', '#', '#', '.', '.', '.', '#' },
		{ '#', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '#' },
		{ '#', '.', '.', '.', '#', '#', '#', '#', '.', '.', '.', '#', '#', '#', '#', '.', '.', '.', '#' },
		{ '#', '.', '.', '.', '#', ' ', ' ', '#', '.', '.', '.', '#', ' ', ' ', '#', '.', '.', '.', '#' },
		{ '#', '#', '#', '#', '#', ' ', ' ', '#', '#', '#', '#', '#', ' ', ' ', '#', '#', '#', '#', '#' }
	}
	-- }}}

	local f = love.graphics.setNewFont('font/PressStart2P-vaV7.ttf', 40)
	tileDimension = {
		x = f:getWidth('#'),
		y = f:getHeight('#')
	}

	tiles = {}
	for y = 1, #level do
		for x = 1, #level[y] do
			local g = level[y][x]
			local c = sn.coordinate.new(x * tileDimension.x, y * tileDimension.y)

			if g == ' ' then
				goto continue
			elseif g == 's' then
				g = '.'
				player = sn.player.new(c:clone())
			end

			local h = g == '#' and 5 or 1

			tiles[#tiles+1] = sn.tile.new(c:clone(), g, h)

			::continue::
		end
	end
end

function love.keypressed (key)
	player:keypressed(key)
end

function love.draw ()
	love.graphics.translate(
		love.graphics.getWidth() / 2 - player.position.x,
		love.graphics.getHeight() / 2 - player.position.y)

	for l = 0, 4 do
		for _, t in pairs(tiles) do
			t:draw(l)
		end
	end

	player:draw()
end
